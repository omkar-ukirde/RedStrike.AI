# DNS Pentesting Skill

## Goal

Enumerate and exploit DNS services to gather information, perform zone transfers, hijack DNS, and discover hidden subdomains.

## Methodology

1. **Banner Grabbing**: Identify DNS server software and version
2. **Zone Transfer**: Attempt AXFR to dump all DNS records
3. **DNS Enumeration**: Query for common record types
4. **Subdomain Bruteforcing**: Discover hidden subdomains
5. **DNS Cache Snooping**: Check for cached records
6. **DNS Exploitation**: Exploit misconfigurations and vulnerabilities

## Tools

* **dig**: DNS lookup utility
* **nslookup**: DNS query tool
* **dnsrecon**: DNS enumeration tool
* **dnsenum**: DNS information gathering
* **fierce**: DNS reconnaissance
* **subfinder/amass**: Subdomain discovery
* **dnschef**: DNS proxy for spoofing

## Example Commands

```bash
# Version detection
dig @target version.bind txt chaos
dig @target hostname.bind txt chaos

# Standard queries
dig @target domain.com ANY
dig @target domain.com A
dig @target domain.com AAAA
dig @target domain.com MX
dig @target domain.com NS
dig @target domain.com TXT
dig @target domain.com SOA
dig @target domain.com CNAME

# Zone transfer (AXFR)
dig @target domain.com AXFR
host -l domain.com target
dnsrecon -d domain.com -a -n target

# Reverse DNS lookup
dig @target -x 192.168.0.1

# DNS enumeration with dnsrecon
dnsrecon -d domain.com -t std
dnsrecon -d domain.com -t brt -D /usr/share/wordlists/subdomains.txt
dnsrecon -d domain.com -t rvl -r 192.168.0.0/24

# dnsenum
dnsenum --dnsserver target domain.com
dnsenum --enum domain.com

# fierce subdomain enumeration
fierce --domain domain.com --dns-servers target

# Nmap DNS scripts
nmap -p53 --script dns-* target
nmap -p53 --script dns-zone-transfer --script-args dns-zone-transfer.domain=domain.com target
nmap -p53 --script dns-brute target
nmap -p53 --script dns-cache-snoop target

# Subdomain bruteforce
gobuster dns -d domain.com -w /usr/share/wordlists/subdomains.txt
subfinder -d domain.com
amass enum -d domain.com

# DNS cache snooping (non-recursive query)
dig @target domain.com A +norecurse
nmap -p53 --script dns-cache-snoop --script-args dns-cache-snoop.mode=timed,dns-cache-snoop.domains={google.com,facebook.com} target
```

## Zone Transfer Attack

```bash
# Using dig
dig @ns1.domain.com domain.com AXFR

# Using host
host -l domain.com ns1.domain.com

# Using nmap
nmap -p53 --script dns-zone-transfer --script-args dns-zone-transfer.domain=domain.com ns1.domain.com

# If successful, you get all DNS records:
# - All hostnames and IPs
# - Mail servers
# - Internal naming conventions
# - Hidden subdomains
```

## DNS Spoofing/Hijacking

```bash
# Using dnschef as DNS proxy
dnschef --fakeip 192.168.0.100 -i 0.0.0.0

# Spoof specific domains
dnschef --fakedomains example.com --fakeip 192.168.0.100

# Use with ARP spoofing to redirect DNS
# See arp_spoofing.md

# Using bettercap
bettercap -iface eth0
> set dns.spoof.domains *.domain.com
> set dns.spoof.address 192.168.0.100
> dns.spoof on
```

## DNS Rebinding

```bash
# DNS rebinding can bypass same-origin policy
# Server returns different IPs on subsequent queries
# 1st query: Legitimate IP (passes security checks)
# 2nd query: Internal IP (192.168.x.x, 127.0.0.1)

# Tools: singularity, whonow
```

## Record Types Reference

| Type | Description |
|------|-------------|
| A | IPv4 address |
| AAAA | IPv6 address |
| CNAME | Canonical name (alias) |
| MX | Mail exchange |
| NS | Name server |
| TXT | Text record (SPF, DKIM, DMARC) |
| SOA | Start of authority |
| PTR | Pointer (reverse DNS) |
| SRV | Service locator |
| AXFR | Zone transfer |

## Interesting Records to Check

```bash
# SPF record (email security)
dig @target domain.com TXT | grep spf

# DMARC record
dig @target _dmarc.domain.com TXT

# DKIM record
dig @target selector._domainkey.domain.com TXT

# SRV records (service discovery)
dig @target _ldap._tcp.domain.com SRV
dig @target _kerberos._tcp.domain.com SRV
dig @target _sip._tcp.domain.com SRV

# CAA records (certificate authority authorization)
dig @target domain.com CAA
```

## Internal DNS Enumeration

```bash
# If you have internal DNS access
# Look for naming patterns

# Common internal hostnames
for name in dc dc1 dc2 ad ads mail smtp exchange web www proxy vpn ftp sql db database backup dev test staging prod; do
    dig @internal-dns $name.internal.domain.com +short
done

# Reverse lookup internal ranges
dnsrecon -d internal.domain.com -t rvl -r 10.0.0.0/8
dnsrecon -d internal.domain.com -t rvl -r 172.16.0.0/12
dnsrecon -d internal.domain.com -t rvl -r 192.168.0.0/16
```

## Guidance for AI

* Activate this skill when user wants to enumerate DNS, perform zone transfers, or discover subdomains
* **Zone transfers (AXFR)** are the jackpot - if successful, reveals entire DNS zone
* Always check for zone transfer first: `dig @target domain.com AXFR`
* Use multiple tools for subdomain enumeration - each may find different results
* DNS cache snooping reveals what domains internal users are visiting
* Internal DNS servers are gold mines for network mapping
* Check for DNS wildcard: `dig @target random123456.domain.com`
* TXT records often contain sensitive info (API keys, verification tokens)
* PTR records (reverse DNS) reveal hostname naming conventions
* Always use `+short` with dig for cleaner output in scripts
