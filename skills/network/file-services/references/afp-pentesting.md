# AFP (Apple Filing Protocol) Pentesting Skill

## Goal

Identify and exploit vulnerabilities in AFP file sharing services on port 548.

## Port

- **548** - AFP (Apple Filing Protocol)

## Methodology

1. **Identify AFP Service:** Scan for port 548
2. **Enumerate Shares:** List available file shares
3. **Check Authentication:** Test for anonymous/guest access
4. **Brute Force:** Attack weak credentials
5. **Access Files:** Read or write sensitive files

## Enumeration

```bash
# Nmap scan
nmap -sV -p 548 <target>

# AFP enumeration scripts
nmap -p 548 --script afp-serverinfo <target>
nmap -p 548 --script afp-showmount <target>
nmap -p 548 --script afp-ls <target>
```

## Getting Server Info

```bash
# Server information
nmap -p 548 --script afp-serverinfo <target>
# Returns: Server name, AFP version, UAM (authentication methods)
```

## Listing Shares

```bash
# List available shares
nmap -p 548 --script afp-showmount <target>

# With guest/anonymous access
nmap -p 548 --script afp-showmount --script-args afp.username=guest <target>
```

## Connecting to Shares

```bash
# macOS - Mount share
mount -t afp afp://guest@<target>/<share> /mnt/afp
mount -t afp afp://user:password@<target>/<share> /mnt/afp

# Linux - Using afpfs-ng
afp_client mount -u guest <target> <share> /mnt/afp
```

## Brute Force

```bash
# Using nmap
nmap -p 548 --script afp-brute <target>

# With custom wordlist
nmap -p 548 --script afp-brute --script-args userdb=users.txt,passdb=passwords.txt <target>
```

## File Operations

```bash
# List directory contents
nmap -p 548 --script afp-ls --script-args afp.username=guest,dir=/path <target>

# Access hidden files
# .DS_Store files may contain directory information
```

## Common Misconfigurations

```bash
# Guest access enabled
# Weak UAMs (User Authentication Methods):
- No User Auth (anonymous)
- Cleartext Password
- DHCAST128 (weak)
```

## Path Traversal (Historical)

```bash
# Old AFP implementations vulnerable to path traversal
# Access files outside shared directories
```

## Tools

* **Nmap** - AFP scripts for enumeration and brute force
* **afpfs-ng** - Linux AFP client
* **macOS Finder** - Native AFP client

## Guidance for AI

* Activate when port 548 is open during network scan
* Check for guest/anonymous access first
* AFP primarily used in macOS environments
* Often found alongside SMB on file servers
* Password may be sent in cleartext with old UAMs
* .DS_Store files in shares may leak directory info
